# å‰ç«¯åŠ è½½é€Ÿåº¦ä¼˜åŒ–è®¡åˆ’

> åˆ›å»ºæ—¶é—´ï¼š2026-02-09

## ç°çŠ¶æ¦‚è¿°

é¡¹ç›®å·²æœ‰çš„ä¼˜åŒ–æªæ–½ï¼š
- âœ… è·¯ç”±æ‡’åŠ è½½ï¼ˆæ‰€æœ‰é¡µé¢ç»„ä»¶ `() => import(...)`)
- âœ… è·¯ç”±çº§æ•°æ® prefetchï¼ˆ`router/prefetch.js`ï¼‰
- âœ… å‰ç«¯å†…å­˜ç¼“å­˜ï¼ˆ`state/dataCache.js`ï¼Œ30s TTLï¼‰
- âœ… åç«¯ Redis ç¼“å­˜ï¼ˆå¸–å­åˆ—è¡¨ 60sã€çƒ­å¸–ç¼“å­˜ï¼‰
- âœ… å¤´åƒé¢„åŠ è½½ç¼“å­˜ï¼ˆ`CachedAvatar.vue`ï¼‰
- âœ… åˆ†é¡µåŠ è½½ï¼ˆå¸–å­åˆ—è¡¨ 20 æ¡/é¡µï¼Œå›å¤ 20 æ¡/é¡µï¼‰
- âœ… Skeleton éª¨æ¶å±

---

## ğŸ”´ P0 â€” é«˜ä¼˜å…ˆçº§ï¼ˆé¢„è®¡å‡å°‘ 40-60% é¦–å±èµ„æºä½“ç§¯ï¼‰

### 1. Element Plus æŒ‰éœ€å¼•å…¥
- **ç°çŠ¶**ï¼š`main.js` ä¸­ `import ElementPlus` å…¨é‡å¼•å…¥ï¼Œæ‰“åŒ…å«æ•´ä¸ªç»„ä»¶åº“ ~700KB JS + ~300KB CSS
- **å®é™…ä½¿ç”¨**ï¼šä»… `el-pagination`ã€`el-select`ã€`el-option`ã€`el-avatar`ã€`el-skeleton`ã€`el-icon`ã€`el-empty`ã€`el-dialog` ç­‰å°‘é‡ç»„ä»¶
- **æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `unplugin-vue-components` + `unplugin-auto-import` å®ç°è‡ªåŠ¨æŒ‰éœ€å¼•å…¥
- **é¢„ä¼°æ”¶ç›Š**ï¼šJS ä½“ç§¯å‡å°‘ ~500KBï¼ŒCSS å‡å°‘ ~200KB

### 2. Element Plus Icons æŒ‰éœ€å¼•å…¥
- **ç°çŠ¶**ï¼š`import * as ElementPlusIconsVue` æ³¨å†Œäº†å…¨éƒ¨ 280+ å›¾æ ‡ç»„ä»¶
- **å®é™…ä½¿ç”¨**ï¼šçº¦ 15-20 ä¸ªå›¾æ ‡
- **æ–¹æ¡ˆ**ï¼šæ”¹ä¸º `import { Search, Connection, ... } from '@element-plus/icons-vue'` æ‰‹åŠ¨æŒ‰éœ€å¼•å…¥
- **é¢„ä¼°æ”¶ç›Š**ï¼šå‡å°‘ ~50KB

### 3. Google Fonts ä¼˜åŒ–
- **ç°çŠ¶**ï¼š`index.html` ä¸­ `<link rel="stylesheet">` åŒæ­¥åŠ è½½ Google Fontsï¼Œæ¸²æŸ“é˜»å¡
- **é—®é¢˜**ï¼šå›½å†…ç”¨æˆ·åŠ è½½ Google Fonts å¯èƒ½éœ€è¦ 2-5 ç§’ç”šè‡³è¶…æ—¶
- **æ–¹æ¡ˆ**ï¼š
  - æ”¹ä¸º `<link rel="preload" as="style">` å¼‚æ­¥åŠ è½½
  - æˆ–ä¸‹è½½å­—ä½“æ–‡ä»¶åˆ°æœ¬åœ° `public/fonts/`ï¼Œé€šè¿‡ `@font-face` æœ¬åœ°å¼•å…¥
  - è®¾ç½® `font-display: swap` é¿å… FOITï¼ˆä¸å¯è§æ–‡æœ¬é—ªçƒï¼‰
- **é¢„ä¼°æ”¶ç›Š**ï¼šé¦–å±æ¸²æŸ“æ—¶é—´å‡å°‘ 1-3 ç§’ï¼ˆå›½å†…ç¯å¢ƒï¼‰

### 4. Vite æ„å»ºä¼˜åŒ–
- **ç°çŠ¶**ï¼š`vite.config.js` æ— ä»»ä½•ç”Ÿäº§æ„å»ºé…ç½®
- **æ–¹æ¡ˆ**ï¼š
  ```js
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          'element-plus': ['element-plus'],
          'markdown': ['marked', 'marked-katex-extension', 'katex', 'dompurify'],
        }
      }
    },
    chunkSizeWarningLimit: 500,
  }
  ```
  - åˆ†ç¦» vendor chunksï¼Œåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ï¼ˆvue/router ä¸å¸¸æ›´æ–°ï¼Œä¸éœ€è¦æ¯æ¬¡é‡æ–°ä¸‹è½½ï¼‰
  - é…åˆ `vite-plugin-compression` è¾“å‡º gzip/brotli é¢„å‹ç¼©æ–‡ä»¶
- **é¢„ä¼°æ”¶ç›Š**ï¼šäºŒæ¬¡è®¿é—®åŠ è½½é€Ÿåº¦æå‡ 50%+

---

## ğŸŸ¡ P1 â€” ä¸­ä¼˜å…ˆçº§ï¼ˆæ”¹å–„ç”¨æˆ·ä½“éªŒæ„ŸçŸ¥ï¼‰

### 5. Prefetch å¹¶è¡ŒåŒ– & éé˜»å¡
- **ç°çŠ¶**ï¼š`router.beforeEach` ä¸­ä¸²è¡Œ `await prefetchCurrentUser()` â†’ `await to.meta.prefetch(to)`ï¼Œé¡µé¢å¯¼èˆªè¢«é˜»å¡
- **æ–¹æ¡ˆ**ï¼š
  ```js
  // å¹¶è¡Œæ‰§è¡Œï¼Œä¸é˜»å¡å¯¼èˆª
  const tasks = []
  if (isFrontAuthedPage) tasks.push(prefetchCurrentUser())
  if (to.meta.prefetch) tasks.push(to.meta.prefetch(to))
  Promise.allSettled(tasks) // ä¸ awaitï¼Œè®©é¡µé¢å…ˆæ¸²æŸ“
  ```
- **é¢„ä¼°æ”¶ç›Š**ï¼šé¡µé¢è·³è½¬æ„ŸçŸ¥é€Ÿåº¦æå‡ 200-500ms

### 6. å¸–å­åˆ—è¡¨è¿”å›æ—¶ä¿ç•™ç¼“å­˜
- **ç°çŠ¶**ï¼š`onActivated` ä¸­ `clearThreadsListCache()` æ¯æ¬¡éƒ½æ¸…ç¼“å­˜é‡æ–°è¯·æ±‚
- **æ–¹æ¡ˆ**ï¼š
  - æ”¹ä¸ºä»…åœ¨å‘å¸–/åˆ å¸–åæ¸…é™¤ç¼“å­˜
  - ä»è¯¦æƒ…é¡µè¿”å›æ—¶ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œåå°é™é»˜åˆ·æ–°ï¼ˆstale-while-revalidate ç­–ç•¥ï¼‰
- **é¢„ä¼°æ”¶ç›Š**ï¼šè¿”å›åˆ—è¡¨é¡µæ— ç™½å±é—ªçƒ

### 7. Markdown/KaTeX å»¶è¿ŸåŠ è½½
- **ç°çŠ¶**ï¼š`marked` + `katex` + `dompurify` åœ¨ `MarkdownContent.vue` è¢« importï¼Œå¸–å­è¯¦æƒ…é¡µåŠ è½½æ—¶å³å¼•å…¥ ~150KB
- **æ–¹æ¡ˆ**ï¼šå°† `MarkdownContent.vue` æ”¹ä¸ºå¼‚æ­¥ç»„ä»¶ `defineAsyncComponent`ï¼Œä»…åœ¨å¸–å­è¯¦æƒ…é¡µéœ€è¦æ¸²æŸ“æ—¶æ‰åŠ è½½
- **é¢„ä¼°æ”¶ç›Š**ï¼šå¸–å­åˆ—è¡¨é¡µå‡å°‘ ~150KB ä¸å¿…è¦çš„åŠ è½½

---

## ğŸŸ¢ P2 â€” ä½ä¼˜å…ˆçº§ï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰

### 8. å›¾ç‰‡æ‡’åŠ è½½
- **ç°çŠ¶**ï¼š`CachedAvatar` ç”¨ JS `new Image()` é¢„åŠ è½½ï¼Œåˆ—è¡¨é¡µ 20 ä¸ªå¤´åƒå¹¶å‘ 20 ä¸ª Image å¯¹è±¡
- **æ–¹æ¡ˆ**ï¼šå¯¹éé¦–å±å¤´åƒä½¿ç”¨ `loading="lazy"`ï¼Œæˆ–ç”¨ `IntersectionObserver` å®ç°æ»šåŠ¨åˆ°è§†å£æ—¶æ‰åŠ è½½

### 9. API è¯·æ±‚åˆå¹¶
- **ç°çŠ¶**ï¼š`Home.vue` çš„ `onMounted` ä¸­ `loadCategories()`ã€`loadTrending()`ã€`loadWsStatus()` ç‹¬ç«‹è°ƒç”¨
- **æ–¹æ¡ˆ**ï¼šç”¨ `Promise.all` ç»Ÿä¸€å¹¶å‘ï¼Œæˆ–åç«¯æä¾› `/api/home-init` èšåˆæ¥å£ä¸€æ¬¡è¿”å›

### 10. é™æ€èµ„æº CDN Hint
- **æ–¹æ¡ˆ**ï¼šåœ¨ `index.html` ä¸­æ·»åŠ  `<link rel="dns-prefetch">` å’Œ `<link rel="preconnect">` åŠ é€Ÿç¬¬ä¸‰æ–¹åŸŸåè§£æï¼ˆå¤´åƒ CDNã€å›¾åºŠç­‰ï¼‰

---

## å®æ–½ä¼˜å…ˆçº§æ’åº

| åºå· | ä¼˜åŒ–é¡¹ | ä¼˜å…ˆçº§ | éš¾åº¦ | é¢„ä¼°æ”¶ç›Š |
|------|--------|--------|------|----------|
| 1 | Element Plus æŒ‰éœ€å¼•å…¥ | P0 | ä¸­ | â­â­â­â­â­ |
| 2 | Icons æŒ‰éœ€å¼•å…¥ | P0 | ä½ | â­â­ |
| 3 | Google Fonts ä¼˜åŒ– | P0 | ä½ | â­â­â­â­ |
| 4 | Vite æ„å»ºä¼˜åŒ– | P0 | ä¸­ | â­â­â­â­ |
| 5 | Prefetch å¹¶è¡ŒåŒ– | P1 | ä½ | â­â­â­ |
| 6 | åˆ—è¡¨ç¼“å­˜ç­–ç•¥ä¼˜åŒ– | P1 | ä½ | â­â­â­ |
| 7 | Markdown å»¶è¿ŸåŠ è½½ | P1 | ä½ | â­â­ |
| 8 | å›¾ç‰‡æ‡’åŠ è½½ | P2 | ä½ | â­ |
| 9 | API è¯·æ±‚åˆå¹¶ | P2 | ä¸­ | â­ |
| 10 | CDN Hint | P2 | ä½ | â­ |

---

## é¢„æœŸæ€»ä½“æ•ˆæœ

- é¦–å± JS ä½“ç§¯ï¼š~1.2MB â†’ ~400KBï¼ˆgzip å ~120KBï¼‰
- é¦–å± CSS ä½“ç§¯ï¼š~350KB â†’ ~80KB
- é¦–å±æ¸²æŸ“æ—¶é—´ï¼ˆå›½å†… 4Gï¼‰ï¼š~4s â†’ ~1.5s
- é¡µé¢è·³è½¬æ„ŸçŸ¥å»¶è¿Ÿï¼š~500ms â†’ ~100ms
