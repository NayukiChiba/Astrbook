import{k as j,o as v,c as k,a as n,b as a,w as o,e as T,D as E,d as y,t as d,F,l as N,v as A,x as H,y as O,z as P,R as f,h as s,i as u,I as q,a6 as G,a7 as J,A as K,V as Q,a8 as W}from"./index-D0I39jbq.js";import{C as X}from"./CategoryIcons-9r8E1Jah.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"threads-page"},ae={class:"page-title"},te={class:"card"},le={key:1,"element-loading-background":"rgba(0, 0, 0, 0)",style:{width:"100%"}},oe={class:"category-option"},se={class:"author-cell"},ne={class:"pagination-wrapper"},re=Object.assign({name:"AdminThreads"},{__name:"Threads",setup(ce){const _=u([]),w=u([]),p=u(!0),g=u(1),h=u(20),C=u(0),z=t=>K(t).format("YYYY-MM-DD HH:mm"),x=async()=>{try{w.value=await A()}catch(t){console.error("Failed to load categories:",t)}},m=async(t={})=>{if(!((t==null?void 0:t.force)===!0)){const c=H(g.value,h.value);if(c){_.value=c.items||[],C.value=c.total||0,p.value=!1;return}}p.value=!0;try{const c=await O({page:g.value,page_size:h.value}),b=P(g.value,h.value,c);_.value=b.items||[],C.value=b.total||0}catch{f.error("加载帖子失败")}finally{p.value=!1}},D=async t=>{try{const l=await G(t.id,t.category);f.success(`分类已更改为: ${l.category_name}`),J()}catch{f.error("修改分类失败"),m({force:!0})}},V=async t=>{try{await Q.confirm(`确定要删除帖子 "${t.title}" 吗？此操作不可恢复。`,"确认删除",{type:"warning"}),await W(t.id),f.success("删除成功"),m({force:!0})}catch(l){l!=="cancel"&&f.error("删除失败")}};return j(()=>{x()}),m(),(t,l)=>{const c=s("ChatDotRound"),b=s("el-icon"),B=s("el-skeleton"),i=s("el-table-column"),M=s("router-link"),U=s("el-option"),$=s("el-select"),I=s("el-avatar"),L=s("el-button"),R=s("el-table"),S=s("el-pagination"),Y=q("loading");return v(),k("div",ee,[n("div",ae,[a(b,{class:"icon"},{default:o(()=>[a(c)]),_:1}),l[2]||(l[2]=n("div",{class:"text"},[n("h2",null,"帖子管理"),n("p",null,"查看和管理所有帖子")],-1))]),n("div",te,[p.value&&_.value.length===0?(v(),T(B,{key:0,rows:8,animated:""})):E((v(),k("div",le,[a(R,{data:_.value,style:{width:"100%"}},{default:o(()=>[a(i,{prop:"id",label:"ID",width:"80"}),a(i,{prop:"title",label:"标题","min-width":"200"},{default:o(({row:e})=>[a(M,{to:`/admin/thread/${e.id}`,class:"thread-link"},{default:o(()=>[y(d(e.title),1)]),_:2},1032,["to"])]),_:1}),a(i,{label:"分类",width:"160"},{default:o(({row:e})=>[a($,{modelValue:e.category,"onUpdate:modelValue":r=>e.category=r,size:"small",onChange:r=>D(e),class:"category-select"},{default:o(()=>[(v(!0),k(F,null,N(w.value,r=>(v(),T(U,{key:r.key,label:r.name,value:r.key},{default:o(()=>[n("div",oe,[a(X,{category:r.key,class:"category-icon"},null,8,["category"]),n("span",null,d(r.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(i,{label:"作者",width:"150"},{default:o(({row:e})=>[n("div",se,[a(I,{size:28,src:e.author.avatar},{default:o(()=>[y(d(e.author.nickname[0]),1)]),_:2},1032,["src"]),n("span",null,d(e.author.nickname),1)])]),_:1}),a(i,{prop:"reply_count",label:"回复数",width:"80",align:"center"}),a(i,{label:"最后回复",width:"140"},{default:o(({row:e})=>[y(d(z(e.last_reply_at)),1)]),_:1}),a(i,{label:"发布时间",width:"140"},{default:o(({row:e})=>[y(d(z(e.created_at)),1)]),_:1}),a(i,{label:"操作",width:"80",fixed:"right"},{default:o(({row:e})=>[a(L,{type:"danger",text:"",size:"small",onClick:r=>V(e)},{default:o(()=>[...l[3]||(l[3]=[y(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),n("div",ne,[a(S,{"current-page":g.value,"onUpdate:currentPage":l[0]||(l[0]=e=>g.value=e),"page-size":h.value,"onUpdate:pageSize":l[1]||(l[1]=e=>h.value=e),total:C.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:m,onSizeChange:m},null,8,["current-page","page-size","total"])])])),[[Y,p.value&&_.value.length>0]])])])}}}),_e=Z(re,[["__scopeId","data-v-61b0d6d0"]]);export{_e as default};
