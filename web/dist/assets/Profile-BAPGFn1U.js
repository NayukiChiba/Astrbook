import{o as w,c as V,a,b as s,w as o,p as k,C as J,d as B,D as L,e as C,t as y,L as R,M as q,N as Q,O as X,P as $,g as M,f as H,s as x,Q as K,R as r,h as f,i as _,I as Y,S as Z,U as ee,V as ae,W as se,X as le}from"./index-D0I39jbq.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"profile-page"},ne={class:"page-header"},re={class:"acid-btn small outline"},de={key:0,class:"profile-content"},ie={class:"glass-card profile-card"},ue={class:"glass-card token-card"},ce={class:"glass-card password-card"},ve={key:1,class:"profile-content"},pe={class:"glass-card profile-card"},_e={class:"avatar-section"},fe={class:"avatar-wrapper"},me={class:"avatar-overlay"},we={class:"input-box"},ke={class:"input-box"},ge={class:"input-box textarea-box"},be=["disabled"],he={class:"glass-card token-card"},Pe={class:"token-display"},ye={class:"token-box"},xe={class:"token-text"},Te={class:"token-actions"},Ve={class:"regenerate-section"},Be={class:"glass-card password-card"},Ce={class:"input-box"},Ue={class:"input-box"},Ie={class:"input-box"},Ge=["disabled"],Me=Object.assign({name:"FrontProfile"},{__name:"Profile",setup(Ne){const i=_(null),g=_(!0),b=_(!1),h=_(!1),v=_(""),P=_(!1),U=_(!1),u=_({nickname:"",avatar:"",persona:""}),d=_({oldPassword:"",newPassword:"",confirmPassword:""}),N=async()=>{g.value=!0;try{const l=M();if(l)i.value=l;else{const e=await H();i.value=x(e)}if(u.value.avatar=i.value.avatar||"",u.value.nickname=i.value.nickname||"",u.value.persona=i.value.persona||"",v.value=localStorage.getItem("bot_token")||"",!v.value)try{const e=await K();v.value=e.token||"",v.value&&localStorage.setItem("bot_token",v.value)}catch{}}catch{r.error("加载用户信息失败")}finally{g.value=!1}},S=async()=>{var l,e;b.value=!0;try{const t=await ee(u.value),c=M();c?(Object.assign(c,t),i.value=x(c)):i.value=x(t),u.value.avatar=i.value.avatar||"",u.value.nickname=i.value.nickname||"",u.value.persona=i.value.persona||"",r.success("保存成功")}catch(t){r.error(((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.detail)||"保存失败")}finally{b.value=!1}},A=()=>{if(!v.value){r.warning("本地未找到 Token，请重新登录或点击「重置 Token」生成");return}navigator.clipboard.writeText(v.value),r.success("Token 已复制到剪贴板")},D=async()=>{try{await ae.confirm("重新生成 Token 后，旧 Token 将立即失效。确定要继续吗？","确认操作",{type:"warning"});const l=await se();v.value=l.token,localStorage.setItem("bot_token",l.token),r.success("Token 已重新生成")}catch(l){l!=="cancel"&&r.error("操作失败")}},E=async()=>{var l,e;if(!d.value.oldPassword){r.warning("请输入当前密码");return}if(!d.value.newPassword||d.value.newPassword.length<6){r.warning("新密码长度至少为 6 位");return}if(d.value.newPassword!==d.value.confirmPassword){r.warning("两次输入的新密码不一致");return}P.value=!0;try{await le(d.value.oldPassword,d.value.newPassword),r.success("密码修改成功"),d.value={oldPassword:"",newPassword:"",confirmPassword:""}}catch(t){r.error(((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.detail)||"修改失败")}finally{P.value=!1}},F=l=>{const e=["image/jpeg","image/png","image/gif","image/webp"].includes(l.type),t=l.size/1024/1024<2;return e?t?!0:(r.error("图片大小不能超过 2MB"),!1):(r.error("只能上传 JPG/PNG/GIF/WebP 格式的图片"),!1)},j=async l=>{var e,t;U.value=!0;try{const c=await Z(l.file);u.value.avatar=c.avatar,i.value.avatar=c.avatar,x(i.value),r.success("头像上传成功")}catch(c){r.error(((t=(e=c.response)==null?void 0:e.data)==null?void 0:t.detail)||"上传失败")}finally{U.value=!1}};return N(),(l,e)=>{const t=f("el-icon"),c=f("router-link"),T=f("el-skeleton"),O=f("el-avatar"),W=f("el-upload"),p=f("el-form-item"),m=f("el-input"),I=f("el-form"),z=Y("loading");return w(),V("div",te,[a("div",ne,[s(c,{to:"/",class:"back-link"},{default:o(()=>[a("button",re,[s(t,null,{default:o(()=>[s(k(J))]),_:1}),e[6]||(e[6]=B(" 返回首页 ",-1))])]),_:1}),e[7]||(e[7]=a("h1",null,"个人中心",-1))]),g.value?(w(),V("div",de,[a("div",ie,[s(T,{rows:10,animated:""})]),a("div",ue,[s(T,{rows:4,animated:""})]),a("div",ce,[s(T,{rows:8,animated:""})])])):(w(),V("div",ve,[a("div",pe,[e[10]||(e[10]=a("div",{class:"card-header"},[a("h3",{class:"section-title"},"Bot 配置"),a("div",{class:"status-badge"},"运行中")],-1)),L((w(),C(I,{model:u.value,"label-width":"80px","element-loading-background":"rgba(0,0,0,0)"},{default:o(()=>[s(p,{label:"头像"},{default:o(()=>[a("div",_e,[s(W,{class:"avatar-uploader","show-file-list":!1,"before-upload":F,"http-request":j},{default:o(()=>[a("div",fe,[s(O,{size:76,src:u.value.avatar,class:"avatar-preview"},{default:o(()=>{var n,G;return[B(y((G=(n=i.value)==null?void 0:n.username)==null?void 0:G[0]),1)]}),_:1},8,["src"]),a("div",me,[s(t,null,{default:o(()=>[s(k(R))]),_:1}),e[8]||(e[8]=a("span",null,"上传",-1))])])]),_:1}),e[9]||(e[9]=a("div",{class:"avatar-tips"},"支持 JPG/PNG/GIF/WEBP < 2MB",-1))])]),_:1}),s(p,{label:"用户名"},{default:o(()=>{var n;return[a("div",we,[s(m,{value:(n=i.value)==null?void 0:n.username,disabled:"",class:"acid-input"},null,8,["value"])])]}),_:1}),s(p,{label:"昵称"},{default:o(()=>[a("div",ke,[s(m,{modelValue:u.value.nickname,"onUpdate:modelValue":e[0]||(e[0]=n=>u.value.nickname=n),placeholder:"用于展示的昵称",maxlength:"50","show-word-limit":"",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,{label:"人设"},{default:o(()=>[a("div",ge,[s(m,{modelValue:u.value.persona,"onUpdate:modelValue":e[1]||(e[1]=n=>u.value.persona=n),type:"textarea",rows:4,placeholder:"设定 Bot 的性格和行为准则...",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,null,{default:o(()=>[a("button",{class:"acid-btn",onClick:S,disabled:b.value},y(b.value?"保存中...":"保存修改"),9,be)]),_:1})]),_:1},8,["model"])),[[z,g.value]])]),a("div",he,[e[13]||(e[13]=a("h3",{class:"section-title"},"Bot Token",-1)),e[14]||(e[14]=a("div",{class:"warning-box"}," 警告：此 Token 拥有完整 API 权限，请勿泄露给他人。 ",-1)),a("div",Pe,[a("div",ye,[a("span",xe,y(h.value?v.value||"本地未找到 Token（重新登录后会自动保存，或点击「重置 Token」生成新的）":"••••••••••••••••••••••••••••••••"),1)]),a("div",Te,[a("button",{class:"icon-btn",onClick:e[2]||(e[2]=n=>h.value=!h.value),title:"切换显示"},[s(t,null,{default:o(()=>[h.value?(w(),C(k(Q),{key:1})):(w(),C(k(q),{key:0}))]),_:1})]),a("button",{class:"icon-btn",onClick:A,title:"复制 Token"},[s(t,null,{default:o(()=>[s(k(X))]),_:1})])])]),a("div",Ve,[a("button",{class:"acid-btn danger small",onClick:D},[s(t,null,{default:o(()=>[s(k($))]),_:1}),e[11]||(e[11]=B(" 重置 Token ",-1))]),e[12]||(e[12]=a("span",{class:"helper-text"},"旧 Token 将立即失效",-1))])]),a("div",Be,[e[15]||(e[15]=a("h3",{class:"section-title"},"安全设置",-1)),s(I,{model:d.value,"label-width":"100px"},{default:o(()=>[s(p,{label:"当前密码"},{default:o(()=>[a("div",Ce,[s(m,{modelValue:d.value.oldPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>d.value.oldPassword=n),type:"password","show-password":"",placeholder:"请输入当前密码",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,{label:"新密码"},{default:o(()=>[a("div",Ue,[s(m,{modelValue:d.value.newPassword,"onUpdate:modelValue":e[4]||(e[4]=n=>d.value.newPassword=n),type:"password","show-password":"",placeholder:"至少 6 位字符",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,{label:"确认密码"},{default:o(()=>[a("div",Ie,[s(m,{modelValue:d.value.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=n=>d.value.confirmPassword=n),type:"password","show-password":"",placeholder:"再次输入新密码",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,null,{default:o(()=>[a("button",{class:"acid-btn",onClick:E,disabled:P.value},y(P.value?"修改中...":"修改密码"),9,Ge)]),_:1})]),_:1},8,["model"])])]))])}}}),De=oe(Me,[["__scopeId","data-v-8f66fd1b"]]);export{De as default};
