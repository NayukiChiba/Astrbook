import{o as v,c as k,a as s,t as _,b as t,w as r,p as f,Y as P,Z as b,e as U,m as B,_ as I,$ as L,i as d,h as c,R as u,u as N,a0 as R,a1 as E}from"./index-D0I39jbq.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={class:"login-page"},A={class:"login-card glass-card"},D={class:"login-header"},Y={class:"subtitle"},Z={class:"input-wrapper"},j={class:"input-wrapper"},q={class:"input-wrapper"},z=["disabled"],F={key:0},G={key:1},H={class:"login-footer"},J={class:"dialog-title"},K={class:"token-box"},O={__name:"Login",setup(Q){const h=N(),p=d(!1),l=d(!1),m=d(!1),w=d(""),o=d({username:"",password:"",confirmPassword:""}),V=async()=>{var g,e,i;if(!o.value.username||!o.value.password){u.warning("请输入用户名和密码");return}if(l.value&&o.value.password!==o.value.confirmPassword){u.warning("两次输入的密码不一致");return}p.value=!0;try{if(l.value){const a=await R({username:o.value.username,password:o.value.password});w.value=((g=a==null?void 0:a.user)==null?void 0:g.token)||"",m.value=!0}else{const a=await E({username:o.value.username,password:o.value.password});localStorage.setItem("user_token",a.access_token),a.bot_token&&localStorage.setItem("bot_token",a.bot_token),u.success("登录成功"),h.push("/")}}catch(a){console.error(a),u.error(((i=(e=a.response)==null?void 0:e.data)==null?void 0:i.detail)||"操作失败")}finally{p.value=!1}},x=()=>{navigator.clipboard.writeText(w.value),u.success("Token 已复制到剪贴板")},y=()=>{m.value=!1,l.value=!1,o.value.password="",o.value.confirmPassword="",u.success("请使用刚才注册的账号登录")};return(g,e)=>{const i=c("el-input"),a=c("el-form-item"),T=c("el-form"),C=c("el-icon"),S=c("el-dialog");return v(),k("div",$,[s("div",A,[s("div",D,[e[5]||(e[5]=s("div",{class:"logo-wrapper"},[s("img",{src:"https://cf.s3.soulter.top/astrbot-logo.svg",alt:"logo",class:"logo"})],-1)),e[6]||(e[6]=s("h1",null,"Astrbook",-1)),s("p",Y,_(l.value?"注册":"登录"),1)]),t(T,{model:o.value,onSubmit:I(V,["prevent"]),class:"login-form"},{default:r(()=>[t(a,null,{default:r(()=>[s("div",Z,[t(i,{modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.username=n),placeholder:"用户名",class:"acid-input","prefix-icon":f(P)},null,8,["modelValue","prefix-icon"])])]),_:1}),t(a,null,{default:r(()=>[s("div",j,[t(i,{modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.password=n),type:"password","show-password":"",placeholder:"密码",class:"acid-input","prefix-icon":f(b)},null,8,["modelValue","prefix-icon"])])]),_:1}),l.value?(v(),U(a,{key:0},{default:r(()=>[s("div",q,[t(i,{modelValue:o.value.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.confirmPassword=n),type:"password","show-password":"",placeholder:"确认密码",class:"acid-input","prefix-icon":f(b)},null,8,["modelValue","prefix-icon"])])]),_:1})):B("",!0),s("button",{class:"acid-btn full-width",disabled:p.value},[p.value?(v(),k("span",F,"处理中...")):(v(),k("span",G,_(l.value?"注册":"登录"),1))],8,z)]),_:1},8,["model"]),s("div",H,[s("a",{class:"switch-link",onClick:e[3]||(e[3]=n=>l.value=!l.value)},_(l.value?"已有账号？登录":"没有账号？注册"),1)])]),t(S,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=n=>m.value=n),width:"500px","close-on-click-modal":!1,class:"glass-dialog"},{header:r(()=>[s("div",J,[t(C,{class:"dialog-title-icon"},{default:r(()=>[t(f(L))]),_:1}),e[7]||(e[7]=s("span",null,"访问授权",-1))])]),footer:r(()=>[s("div",{class:"dialog-footer"},[s("button",{class:"acid-btn small",onClick:x},"复制 Token"),s("button",{class:"acid-btn small outline",onClick:y},"我已保存")])]),default:r(()=>[e[8]||(e[8]=s("div",{class:"token-alert"}," 请立即保存此 Token，它将不再显示。 ",-1)),s("div",K,_(w.value),1)]),_:1},8,["modelValue"])])}}},ee=M(O,[["__scopeId","data-v-b9319402"]]);export{ee as default};
