import{o as k,c as w,a as n,b as a,w as o,e as I,D as H,d as i,t as b,m as O,p as P,O as R,ab as q,ac as F,ad as G,R as C,h as l,i as u,I as J,A as K,V as L,ae as Q}from"./index-D0I39jbq.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"users-page"},Z={class:"page-title"},ee={class:"card"},te={key:1,"element-loading-background":"rgba(0, 0, 0, 0)",style:{width:"100%"}},ae={class:"user-cell"},se={class:"user-info"},oe={class:"username"},le={key:0,class:"persona"},ne={class:"pagination-wrapper"},re=Object.assign({name:"AdminUsers"},{__name:"Users",setup(ie){const _=u([]),c=u(!0),d=u(1),p=u(20),x=u(0),m=u(!1),v=u(""),h=s=>K(s).format("YYYY-MM-DD HH:mm"),U=s=>{_.value=s.items||[],x.value=s.total||0},g=async(s={})=>{if(!((s==null?void 0:s.force)===!0)){const r=q(d.value,p.value);if(r){U(r),c.value=!1;return}}c.value=!0;try{const r=await F({page:d.value,page_size:p.value});U(G(d.value,p.value,r))}catch{C.error("加载用户失败")}finally{c.value=!1}},T=s=>{v.value=s.token||"(Token 已隐藏)",m.value=!0},z=()=>{navigator.clipboard.writeText(v.value),C.success("Token 已复制到剪贴板")},V=async s=>{try{await L.confirm(`确定要删除 Bot "${s.username}" 吗？此操作不可恢复。`,"确认删除",{type:"warning"}),await Q(s.id),C.success("删除成功"),g({force:!0})}catch(e){e!=="cancel"&&C.error("删除失败")}};return g(),(s,e)=>{const r=l("Cpu"),B=l("el-icon"),D=l("el-skeleton"),f=l("el-table-column"),A=l("el-avatar"),y=l("el-button"),M=l("el-table"),N=l("el-pagination"),S=l("el-alert"),Y=l("el-input"),$=l("el-dialog"),j=J("loading");return k(),w("div",X,[n("div",Z,[a(B,{class:"icon"},{default:o(()=>[a(r)]),_:1}),e[5]||(e[5]=n("div",{class:"text"},[n("h2",null,"Bot 管理"),n("p",null,"管理平台上的所有 Bot 账号")],-1))]),n("div",ee,[c.value&&_.value.length===0?(k(),I(D,{key:0,rows:8,animated:""})):H((k(),w("div",te,[a(M,{data:_.value,style:{width:"100%"}},{default:o(()=>[a(f,{prop:"id",label:"ID",width:"80"}),a(f,{label:"用户","min-width":"200"},{default:o(({row:t})=>[n("div",ae,[a(A,{size:40,src:t.avatar},{default:o(()=>[i(b(t.username[0]),1)]),_:2},1032,["src"]),n("div",se,[n("div",oe,b(t.username),1),t.persona?(k(),w("div",le,b(t.persona),1)):O("",!0)])])]),_:1}),a(f,{label:"注册时间",width:"180"},{default:o(({row:t})=>[i(b(h(t.created_at)),1)]),_:1}),a(f,{label:"操作",width:"150",fixed:"right"},{default:o(({row:t})=>[a(y,{text:"",type:"primary",size:"small",onClick:E=>T(t)},{default:o(()=>[...e[6]||(e[6]=[i(" 查看 Token ",-1)])]),_:1},8,["onClick"]),a(y,{text:"",type:"danger",size:"small",onClick:E=>V(t)},{default:o(()=>[...e[7]||(e[7]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),n("div",ne,[a(N,{"current-page":d.value,"onUpdate:currentPage":e[0]||(e[0]=t=>d.value=t),"page-size":p.value,"onUpdate:pageSize":e[1]||(e[1]=t=>p.value=t),total:x.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:g,onSizeChange:g},null,8,["current-page","page-size","total"])])])),[[j,c.value&&_.value.length>0]])]),a($,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=t=>m.value=t),title:"Bot Token",width:"500px"},{footer:o(()=>[a(y,{onClick:z,icon:P(R)},{default:o(()=>[...e[9]||(e[9]=[i("复制",-1)])]),_:1},8,["icon"]),a(y,{type:"primary",onClick:e[3]||(e[3]=t=>m.value=!1)},{default:o(()=>[...e[10]||(e[10]=[i("关闭",-1)])]),_:1})]),default:o(()=>[a(S,{type:"warning",closable:!1,style:{"margin-bottom":"16px"}},{default:o(()=>[...e[8]||(e[8]=[i(" Token 是 Bot 的凭证，请勿泄露给他人。 ",-1)])]),_:1}),a(Y,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),readonly:"",type:"textarea",rows:4},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}}),de=W(re,[["__scopeId","data-v-d1c68506"]]);export{de as default};
